package com.doublez.pocketmindserver.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

public class JinaReaderClientTest {

    @Test
    public void testDeserialization() throws Exception {
        String json = """
{"code":200,"status":20000,"data":{"title":"G3mini on X: \\"Nano Banana, but make it holiday and extra nano. \\n\\nOpen the Gemini app and type: Micro diorama: tiny people [insert action] on/with [insert object(s)], winter forest background, soft golden light. AR 1:1\\n\\nDrop your outputs in the replies! \\" / X","description":"","url":"https://x.com/GeminiApp/status/2003601603325231587","content":"G3mini on X: \\"Nano Banana, but make it holiday and extra nano. Open the Gemini app and type: Micro diorama: tiny people [insert action] on/with [insert object(s)], winter forest background, soft golden light. AR 1:1 Drop your outputs in the replies! \\" / X\\n===============\\n\\nDont miss whats happening\\n\\nPeople on X are the first to know.\\n\\n[Log in](https://x.com/login)\\n\\n[Sign up](https://x.com/i/flow/signup)\\n\\n[](https://x.com/)\\n==================\\n\\nPost\\n----\\n\\nSee new posts\\n\\nConversation\\n============\\n\\n[![Image 2: Square profile picture](https://pbs.twimg.com/profile_images/1940093473564073984/jiafRcO0_normal.png)](https://x.com/GeminiApp)\\n\\n[G3mini ![Image 3](https://pbs.twimg.com/profile_images/1972718204565811200/adTFhODz_bigger.jpg)](https://x.com/GeminiApp)\\n\\n[@GeminiApp](https://x.com/GeminiApp)\\n\\nNano Banana, but make it holiday and extra nano. Open the Gemini app and type: Micro diorama: tiny people [insert action] on/with [insert object(s)], winter forest background, soft golden light. AR 1:1 Drop your outputs in the replies! \\n\\nSlide 1 of 4 - Carousel\\n\\n*   [![Image 4](https://pbs.twimg.com/media/G83Xdl7bYAAxD3L?format=jpg&name=small) Try Nano Banana Pro Today](https://gemini.google.com/app/download/mobile?android-min-version=301356232&ios-min-version=322.0&is_sa=1&campaign_id=nanobanana_pro_boosting&utm_source=x&utm_medium=paid-social&utm_campaign=nanobanana_pro_boosting&pt=9008&mt=8&ct=nanobanana_pro_x_boosting&redirect=home)  \\n*   [![Image 5](https://pbs.twimg.com/media/G83XdlvbMAAWqeL?format=jpg&name=small) Try Nano Banana Pro Today](https://gemini.google.com/app/download/mobile?android-min-version=301356232&ios-min-version=322.0&is_sa=1&campaign_id=nanobanana_pro_boosting&utm_source=x&utm_medium=paid-social&utm_campaign=nanobanana_pro_boosting&pt=9008&mt=8&ct=nanobanana_pro_x_boosting&redirect=home)  \\n\\nFrom google.com\\n\\n[11:00 PM  Dec 23, 2025](https://x.com/GeminiApp/status/2003601603325231587)\\n\\n\\n\\n72.9K\\n\\nViews\\n\\n156\\n\\n114\\n\\n955\\n\\n601\\n\\nRead 156 replies\\n\\nNew to X?\\n---------\\n\\nSign up now to get your own personalized timeline!\\n\\nSign up with Apple\\n\\n[Create account](https://x.com/i/flow/signup)\\n\\nBy signing up, you agree to the [Terms of Service](https://x.com/tos) and [Privacy Policy](https://x.com/privacy), including [Cookie Use.](https://help.x.com/rules-and-policies/twitter-cookies)\\n\\nTrending now\\n============\\n\\nWhats happening\\n----------------\\n\\nTrending in United States\\n\\nLutnick\\n\\n8,653 posts\\n\\nTrending in United States\\n\\nEmmanuel\\n\\n39.7K posts\\n\\nTrending in United States\\n\\nThe Vault\\n\\n10.7K posts\\n\\nTrending in United States\\n\\nLa Navidad\\n\\n322K posts\\n\\n[Show more](https://x.com/explore/tabs/for-you)\\n\\n[Terms of Service](https://x.com/tos)\\n\\n|\\n\\n[Privacy Policy](https://x.com/privacy)\\n\\n|\\n\\n[Cookie Policy](https://support.x.com/articles/20170514)\\n\\n|\\n\\n[Accessibility](https://help.x.com/resources/accessibility)\\n\\n|\\n\\n[Ads info](https://business.x.com/en/help/troubleshooting/how-twitter-ads-work.html?ref=web-twc-ao-gbl-adsinfo&utm_source=twc&utm_medium=web&utm_campaign=ao&utm_content=adsinfo)\\n\\n|\\n\\nMore\\n\\n 2025 X Corp.","publishedTime":"Wed, 24 Dec 2025 17:01:04 GMT","metadata":{"lang":"en","viewport":"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover","fb:app_id":"2231777543","og:site_name":"X (formerly Twitter)","google-site-verification":"reUF-TgZq93ZGtzImw42sfYglI2hY0QiGRmfc4jeKbs","facebook-domain-verification":"x6sdcc8b5ju3bh8nbm59eswogvg6t1","twitter-site-verification":"uUx8nTdIpdaT5rAUotZ7H4rP5NsEDATT/eXYmzldaYh9XL072uDoweVDueFB1Htq","theme-color":["#FFFFFF","#000000"],"og:image":"https://abs.twimg.com/rweb/ssr/default/v2/og/image.png","og:title":"G3mini on X: \\"Nano Banana, but make it holiday and extra nano. \\n\\nOpen the Gemini app and type: Micro diorama: tiny people [insert action] on/with [insert object(s)], winter forest background, soft golden light. AR 1:1\\n\\nDrop your outputs in the replies! \\" / X"},"external":{"preconnect":{"https://abs.twimg.com/":{},"https://api.twitter.com/":{},"https://api.x.com/":{},"https://pbs.twimg.com/":{},"https://t.co/":{},"https://video.twimg.com/":{}},"dns-prefetch":{"https://abs.twimg.com/":{},"https://api.twitter.com/":{},"https://api.x.com/":{},"https://pbs.twimg.com/":{},"https://t.co/":{},"https://video.twimg.com/":{}},"preload":{"https://abs.twimg.com/responsive-web/client-web/vendor.0d0c9dda.js":{"nonce":"NTYzMzkxNmYtZjYyOS00NjBlLTk2NDYtNmU3Nzg4ZGE0YjUz","as":"script","crossorigin":"anonymous"},"https://abs.twimg.com/responsive-web/client-web/i18n/en.757b16aa.js":{"nonce":"NTYzMzkxNmYtZjYyOS00NjBlLTk2NDYtNmU3Nzg4ZGE0YjUz","as":"script","crossorigin":"anonymous"},"https://abs.twimg.com/responsive-web/client-web/main.2a44b98a.js":{"nonce":"NTYzMzkxNmYtZjYyOS00NjBlLTk2NDYtNmU3Nzg4ZGE0YjUz","as":"script","crossorigin":"anonymous"}},"search":{"https://x.com/os-x.xml":{"type":"application/opensearchdescription+xml","title":"X"},"https://x.com/os-grok.xml":{"type":"application/opensearchdescription+xml","title":"Grok"}},"apple-touch-icon":{"https://abs.twimg.com/responsive-web/client-web/icon-ios.77d25eba.png":{"sizes":"192x192"}},"manifest":{"https://x.com/manifest.json":{"crossorigin":"use-credentials"}},"mask-icon":{"https://abs.twimg.com/responsive-web/client-web/icon-svg.ea5ff4aa.svg":{"sizes":"any","color":"#1D9BF0"}},"icon":{"https://abs.twimg.com/favicons/twitter.3.ico":{}},"canonical":{"https://x.com/GeminiApp/status/2003601603325231587":{"data-rh":"true"}},"alternate":{"https://publish.x.com/oembed?url=https://x.com/GeminiApp/status/2003601603325231587":{"title":"G3mini on X: \\"Nano Banana, but make it holiday and extra nano. \\n\\nOpen the Gemini app and type: Micro diorama: tiny people [insert action] on/with [insert object(s)], winter forest background, soft golden light. AR 1:1\\n\\nDrop your outputs in the replies! \\"","type":"application/json+oembed","data-rh":"true"}}},"usage":{"tokens":893}},"meta":{"usage":{"tokens":893}}}
            """;

        ObjectMapper mapper = new ObjectMapper();
        JinaReaderClient.JinaResponse response = mapper.readValue(json, JinaReaderClient.JinaResponse.class);

        assertNotNull(response);
        assertEquals(200, response.code());
        assertEquals(20000, response.status());
        assertNotNull(response.data());
        assertEquals("https://x.com/GeminiApp/status/2003601603325231587", response.data().url());
        assertEquals("Wed, 24 Dec 2025 17:01:04 GMT", response.data().publishedTime());
        assertNotNull(response.data().metadata());
        assertEquals("en", response.data().metadata().get("lang"));
        assertNotNull(response.data().usage());
        assertEquals(893, response.data().usage().get("tokens"));
        
        // Verify Title and Content as requested
        assertNotNull(response.data().title());
        assertNotNull(response.data().content());
        
        System.out.println("Deserialization successful!");
        System.out.println("Title: " + response.data().title());
        System.out.println("Content length: " + response.data().content().length());
    }
}